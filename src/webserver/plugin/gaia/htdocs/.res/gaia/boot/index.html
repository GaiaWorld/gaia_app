<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
	<title>GAIA</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="../test/framework/mocha.css" />
	<script type="text/javascript">
		var winit = {};
		(function () {
			winit.win = {};
			var k;
			for (k in window) {
				if (window.hasOwnProperty(k))
					winit.win[k] = 1;
			}
			winit.startTime = Date.now();
			var name = "gaia"; // 每个项目需要定义自己的名称，该名称决定了访问域名和本地存储名
			var main = document.domain.replace(/^(\D+\w*\.)(\w+\.[\w\.]+)/, "$2");
			var remote = (document.domain != main || /^\w+\.\w+$/.test(document.domain)) ? name + "." : "";
			winit.store = name;
			// winit.debug = !remote;
			winit.debug = true
			// winit.debug = location.host.indexOf('192.168.31') > -1;
			main = location.port ? main + ":" + location.port : main;

			var needCDN = true;

			winit.domains = [location.protocol + "//" + (remote ? needCDN ? "" + remote : "" + remote : "") + main, location.protocol +
				"//" + remote + main
			];

			// 读取JS的Function
			winit.loadJS = function (roots, url, charset, callback, errText, i) {
				var u, n, head;
				if (i >= roots.length) {
					return callback && callback(roots[0] + url, errText);
				}
				head = document.head || document.getElementsByTagName('head')[0] || document.documentElement;
				n = document.createElement('script');
				n.charset = charset;
				n.onerror = function () {
					n.onload = n.onerror = undefined;
					head.removeChild(n);
					winit.loadJS(roots, url, charset, callback, errText, i === undefined ? 0 : i + 1);
				};
				n.onload = function () {
					n.onload = n.onerror = undefined;
					head.removeChild(n);
					callback && callback(roots[i || 0] + url);
				};
				n.async = true;
				n.crossorigin = true;
				n.src = roots[i || 0] + url;
				head.appendChild(n);
			};
			winit.initFail = function (url, err) {
				err ? alert(err + ", " + url) : "";
			};
			winit.init = function () {};
			winit.flags = {};
			winit.start = function () {
				if (winit.debug) winit.loadJS([winit.domains[1]], "/gaia/boot/hotfix.js", "utf8", winit.initFail,
					"load hotupdate error");
				winit.loadJS([winit.domains[1]], "/gaia/boot/index.js?" + Math.random(), "utf8", winit.initFail,
					"load index error");
			};
			winit.start();
		})();
	</script>
</head>

<body>
	<div id="mocha"></div>
</body>

</html>